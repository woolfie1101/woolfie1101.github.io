---
layout: single
title:  "[ElasticSearch] Part 2 - ê³ ê¸‰ ê²€ìƒ‰ ê¸°ëŠ¥ 01"
categories:
  - db  #ì¹´í…Œê³ ë¦¬
tag: [db, elasticsearch, fts] #íƒœê·¸
last_modified_at : 2025/04/19
toc: true  #ì˜¤ë¥¸ìª½ì— ìˆëŠ” ëª©ì°¨
toc_sticky: true #ëª©ì°¨ ê³ ì •
author_profile: true  #ì™¼ìª½ì— ìê¸° ì†Œê°œë€ í”„ë¡œí•„ì„ ì´ í˜ì´ì§€ì— ë“¤ì–´ê°ˆë•Œ ë„ëŠ” ê¸°ëŠ¥
sidebar:
  nav: "sidebar-category" #navigation.ymlì— ìˆëŠ” docsë¥¼ ëœ»í•œë‹¤.
search: true  #ì´ í˜ì´ì§€ëŠ” ê²€ìƒ‰ì— ë‚˜ì˜´.
---


# Elasticsearch(2)

<aside>
ğŸ’¡

ê³ ê¸‰ ê²€ìƒ‰ ê¸°ëŠ¥

</aside>

# [1] ê°œìš”

ì´ë²ˆ ì¥ì—ì„œëŠ” ESì˜ ê¸°ë³¸ì ì¸ ê²€ìƒ‰ ê¸°ëŠ¥ì„ ë„˜ì–´ì„œ ì‹¤ì „ ì„œë¹„ìŠ¤ì—ì„œ ì‚¬ìš©í•˜ëŠ” ê³ ê¸‰ ê²€ìƒ‰ ê¸°ëŠ¥, PostgreSQLê³¼ì˜ ì—°ë™ ë°©ì‹ê¹Œì§€ í•¨ê»˜ ì‚´í´ ë³¼ ê²ƒì´ë‹¤.

## (1) ì£¼ìš” ëª©í‘œ

- ì •í™•í•œ ê²€ìƒ‰ (match_phrase)
- ì˜¤íƒ€ êµì • (fuzzy)
- ê²€ìƒ‰ì–´ ê°•ì¡° (highlight)
- ê²€ìƒ‰ì–´ ìš°ì„ ìˆœìœ„ ì„¤ì • (boost)
- ì¡°ê±´ í•„í„°ë§ (filter)
- ìë™ì™„ì„± (autocomplete)
- ì¸ê¸° í‚¤ì›Œë“œ ì§‘ê³„ (aggregation)
- ì‹œê°„ëŒ€ë³„/ì¡°ê±´ë³„ Kibana ì‹œê°í™”
- PostgreSQLê³¼ì˜ ë°ì´í„° ì—°ë™
- ë‹¤êµ­ì–´(í•œêµ­ì–´ + ì˜ì–´) ë™ì‹œ ê²€ìƒ‰

---

# [2] ê³ ê¸‰ ê²€ìƒ‰ ê¸°ëŠ¥

## (1) ìë™ ì™„ì„±

ìë™ì™„ì„±ì€ ë³´í†µ ê²€ìƒ‰ì–´ ì•ë¶€ë¶„ë§Œ ì…ë ¥í•´ë„ ì¶”ì²œë¦¬ìŠ¤íŠ¸ê°€ ëœ¬ë‹¤. 

ì˜ˆì‹œ) â€œê²€â€ ì…ë ¥ â†’ â€œê²€ìƒ‰â€, â€œê²€í† â€, â€œê²€ì‚¬â€ ì¶”ì²œ

ì´ê±¸ êµ¬í˜„í•˜ë ¤ë©´ ESì—ì„œ **edge_ngram tokenizer**ë¥¼ ì‚¬ìš©í•œ **custom analyzer**ë¥¼ ì„¤ì •í•´ì•¼í•œë‹¤.

### 1) ìë™ì™„ì„± ì „ìš© ì¸ë±ìŠ¤ ë§Œë“¤ê¸°

1. ì¸ë±ìŠ¤ ì„¤ì •
    
    ```json
    PUT /autocomplete_test
    {
      "settings": {
        "analysis": {
          "tokenizer": {
            "autocomplete_tokenizer": {
              "type": "edge_ngram",
              "min_gram": 1,
              "max_gram": 20,
              "token_chars": ["letter", "digit", "whitespace"]
            }
          },
          "analyzer": {
            "autocomplete_analyzer": {
              "type": "custom",
              "tokenizer": "autocomplete_tokenizer",
              "filter": ["lowercase"]
            }
          }
        }
      },
      "mappings": {
        "properties": {
          "suggest": {
            "type": "text",
            "analyzer": "autocomplete_analyzer",
            "search_analyzer": "standard"
          }
        }
      }
    }
    ```
    
    - "ê²€" â†’ "ê²€ì‚¬", "ê²€ì¦", "ê²€ìƒ‰" ê°™ì´ **ì•ì—ì„œë¶€í„° ìœ ì‚¬í•œ ë‹¨ì–´ë“¤ ë§¤ì¹­** ê°€ëŠ¥
    - "suggest" í•„ë“œì— ìë™ì™„ì„±ìš© í…ìŠ¤íŠ¸ë¥¼ ì €ì¥í•´ì•¼ í•œë‹¤.
2. ì¸ë±ìŠ¤ ë¶„ì„
    
    ```json
    PUT /autocomplete_test
    {
      "settings": {
        "analysis": {
          "tokenizer": { //ES ë¬¸ë²•ì— ë”°ë¼ ì •í•´ì§„ í•„ë“œ ì´ë¦„
            "autocomplete_tokenizer": { //ì‚¬ìš©ì ì •ì˜ ì´ë¦„ (ì¤‘ë³µ ë¶ˆê°€)
              "type": "edge_ngram", //ìë™ ì™„ì„± êµ¬í˜„ì˜ í•µì‹¬
              //ì˜ˆë¥¼ ë“¤ì–´ "ì¸ê³µì§€ëŠ¥"ì´ë¼ëŠ” í…ìŠ¤íŠ¸ê°€ ë“¤ì–´ì˜¤ë©´ -> "ì¸", "ì¸ê³µ", "ì¸ê³µì§€", "ì¸ê³µì§€ëŠ¥"
              "min_gram": 1, //ë‹¨ì–´ë¥¼ ìë¥¼ ìµœì†Œ ê¸¸ì´
              "max_gram": 20, //ë‹¨ì–´ë¥¼ ìë¥¼ ìµœëŒ€ ê¸¸ì´
              "token_chars": ["letter", "digit", "whitespace"] 
              //ì–´ë–¤ ì¢…ë¥˜ì˜ ë¬¸ìë“¤ì„ í† í°í™” í• ì§€ ê²°ì •
            }
          },
          "analyzer": { //ES ë¬¸ë²•ì— ë”°ë¼ ì •í•´ì§„ í•„ë“œ ì´ë¦„
            "autocomplete_analyzer": { //ì‚¬ìš©ì ì •ì˜ ì´ë¦„ (ì¤‘ë³µ ë¶ˆê°€)
              "type": "custom",
              "tokenizer": "autocomplete_tokenizer", //ìœ„ì—ì„œ ë§Œë“  edge_ngram í† í¬ë‚˜ì´ì € ê¸°ë°˜
              "filter": ["lowercase"] //ëª¨ë“  ë¬¸ìë¥¼ ì†Œë¬¸ìí™”
            }
          }
        }
      },
      "mappings": {
        "properties": {
          "suggest": {
            "type": "text",
            "analyzer": "autocomplete_analyzer", //edge_ngram ìœ¼ë¡œ í† í° ì €ì¥
            //ì €ì¥í•  ë• â€œì¸ê³µì§€ëŠ¥â€ì„ â€œì¸â€, â€œì¸ê³µâ€, â€œì¸ê³µì§€â€, â€¦ë¡œ ì €ì¥
            "search_analyzer": "standard" //standard ë¶„ì„ê¸°ë¡œ ê²€ìƒ‰ â†’ ì¼ë°˜ì ìœ¼ë¡œ ê²€ìƒ‰ì–´ ìì²´ë¥¼ ê·¸ëŒ€ë¡œ ì‚¬ìš©
            //ê²€ìƒ‰í•  ë• ì‚¬ìš©ìê°€ ì…ë ¥í•œ "ì¸ê³µ" ê°™ì€ ë‹¨ì–´ë¥¼ ê·¸ëŒ€ë¡œ ë§¤ì¹­í•´ì¤Œ
          }
        }
      }
    }
    ```
    
    - tokenizerì™€ analyzerì˜ ì°¨ì´ì 
        
        
        | **êµ¬ë¶„** | **ì„¤ëª…** | **ì˜ˆì‹œ** |
        | --- | --- | --- |
        | **tokenizer** | ë¬¸ìì—´ì„ **í† í°(ë‹¨ì–´ ì¡°ê°)** ìœ¼ë¡œ ë‚˜ëˆ„ëŠ” ì—­í•  | "ì¸ê³µì§€ëŠ¥" â†’ ["ì¸ê³µ", "ì§€ëŠ¥"] |
        | **analyzer** | tokenizer + **ì¶”ê°€ í•„í„°ë“¤** (ì˜ˆ: ì†Œë¬¸ìí™”, ë¶ˆìš©ì–´ ì œê±° ë“±)ì„ ë¬¶ì€ ë‹¨ìœ„ | "AI 2024" â†’ ["ai", "2024"] (lowercase ì ìš©ë¨) |
        
        ì¦‰, **analyzerëŠ” tokenizer + filterë“¤ì˜ ì¡°í•©**ì´ë‹¤.
        
    - token_charsì˜ ì¢…ë¥˜ (ìì£¼ ì“°ëŠ” 5ê°€ì§€)
        
        
        | **ê°’** | **ì˜ë¯¸** |
        | --- | --- |
        | "letter" | ë¬¸ì (AZ, ê°€í•˜ ë“±) |
        | "digit" | ìˆ«ì (0~9) |
        | "whitespace" | ê³µë°± |
        | "punctuation" | ë¬¸ì¥ ë¶€í˜¸ (.,!?) |
        | "symbol" | íŠ¹ìˆ˜ ë¬¸ì (@#$ ë“±) |
        - ì˜ˆì‹œ
            - "token_chars": ["letter"]
                - â€œtest123erâ€ â†’ ["test", "er"]
                - ìµœì¢… ì €ì¥ í† í° : ["t", "te", "tes", "test", "e", "er"]
            - "token_chars": ["letter", â€œdigitâ€]
                - "test123er" â†’ ["test123er"]
                - ìµœì¢… ì €ì¥ í† í° : ["t", "te", "tes", ..., "test123er"]
        - ì˜ˆì‹œ ì •ë¦¬
            
            
            | **token_chars ì„¤ì •** | **â€œtest 123 erâ€ ì²˜ë¦¬ ë°©ì‹** | **ê²°ê³¼ ì˜ˆì‹œ** |
            | --- | --- | --- |
            | ["letter", "digit"] | ê³µë°± ê¸°ì¤€ìœ¼ë¡œ ë‚˜ëˆ” | ["t", "te", "tes", "test", "1", "12", "123", "e", "er"] |
            | ["letter", "digit", "whitespace"] | ì „ì²´ ë¬¸ì¥ í•˜ë‚˜ë¡œ ì²˜ë¦¬ | ["t", "te", "tes", "test", "test ", "test 1", "test 12", "test 123",
            "test 123 ", "test 123 e", "test 123 er"] |

### 2) **ìë™ì™„ì„±ìš© ë°ì´í„° ì‚½ì…**

autocomplete_test ì¸ë±ìŠ¤ì— ì•„ë˜ì²˜ëŸ¼ ì¶”ì²œ ë‹¨ì–´ë“¤ì„ ë„£ì–´ë³´ì.

ì‹¤ì œ ê²€ìƒ‰ì–´ ì¶”ì²œ ë¦¬ìŠ¤íŠ¸ë¼ê³  ìƒê°í•˜ë©´ ëœë‹¤.

- Kibana Dev Toolsì—ì„œ ì‹¤í–‰
    
    ```json
    POST /autocomplete_test/_doc
    {
      "suggest": "ê²€ìƒ‰"
    }
    
    POST /autocomplete_test/_doc
    {
      "suggest": "ê²€í† "
    }
    
    POST /autocomplete_test/_doc
    {
      "suggest": "ê²€ì‚¬"
    }
    
    POST /autocomplete_test/_doc
    {
      "suggest": "ê²€ì—´"
    }
    
    POST /autocomplete_test/_doc
    {
      "suggest": "ê²€ì€ ê³ ì–‘ì´"
    }
    ```
    
    ğŸ‘‰ í•„ìëŠ” í•œê¸€ë¡œ ì¼ë¶€ëŸ¬ ë¹„ìŠ·í•œ ì ‘ë‘ì–´ë¡œ ì‹œì‘í•˜ëŠ” ë‹¨ì–´ë“¤ì„ ë„£ì—ˆë‹¤.
    

### 3) **ìë™ì™„ì„± ê²€ìƒ‰ í…ŒìŠ¤íŠ¸**

- ì´ì œ "ê²€"ë§Œ ì…ë ¥í–ˆì„ ë•Œ, ìœ„ì˜ ì¶”ì²œì–´ë“¤ì´ ì˜ ë§¤ì¹­ë˜ëŠ”ì§€ í…ŒìŠ¤íŠ¸í•´ë³´ì
    
    ```json
    GET /autocomplete_test/_search
    {
      "query": {
        "match": {
          "suggest": "ê²€"
        }
      }
    }
    ```
    
    ![image.png](/assets/images/2025/04/19/image0.png)
    
- â€œê²…â€ ì´ë¼ê³  ì…ë ¥í–ˆì„ ê²½ìš°, ê°’ì´ ë‚˜ì˜¤ì§ˆ ì•ŠëŠ”ë‹¤.
    
    ![image.png](/assets/images/2025/04/19/image1.png)
    
    â†’ edge_ngram í† í° ë¦¬ìŠ¤íŠ¸ì— â€œê²…â€ì´ ì—†ê¸° ë•Œë¬¸
    
- â€œìƒ‰â€ ì´ë¼ê³  ì…ë ¥í–ˆì„ ê²½ìš°, ê°’ì´ ë‚˜ì˜¤ì§ˆ ì•ŠëŠ”ë‹¤.
    
    ![image.png](/assets/images/2025/04/19/image2.png)
    
    â†’ edge_ngram í† í° ë¦¬ìŠ¤íŠ¸ì— â€œìƒ‰â€ì´ ì—†ê¸° ë•Œë¬¸
    
- edge_ngramì€ ì•ê¸€ì ê¸°ì¤€ìœ¼ë¡œ ì¶”ì²œì„ í•œë‹¤.

### 4) ìë™ì™„ì„± ì¶”ì²œì–´ì˜ êµ¬ì„± ë°©ë²•

ì‹¤ìŠµí•˜ë©´ ì•Œê²Œë˜ëŠ” ì‚¬ì‹¤ì´ ìˆë‹¤. ê·¸ ì‚¬ì‹¤ì€ ë°”ë¡œ, ìë™ì™„ì„± ì¶”ì²œì–´ë¥¼ êµ¬ì„±í•˜ë ¤ë©´ í•´ë‹¹ ì¶”ì²œì–´ë“¤ì„ ì¶”ê°€í•´ì•¼í•œë‹¤ëŠ” ê²ƒì´ë‹¤. 

í•œêµ­ì–´ì—ì„œ ì‚¬ìš©í•˜ëŠ” ë‹¨ì–´ëŠ” ëŒ€ëµ 511,000ê°œ ì´ìƒì´ë‹¤. 
ê·¸ëŸ¼, ì´ ë‹¨ì–´ë“¤ì„ ì „ë¶€ ë„£ì–´ì•¼í•˜ëŠ” ê±¸ê¹Œ? 
ê²°ë¡ ì„ ë§í•˜ìë©´, ì´ ë‹¨ì–´ë“¤ì„ ì „ë¶€ ë„£ì§€ ì•Šì•„ë„ ëœë‹¤. 

**ì„œë¹„ìŠ¤ì—ì„œ ì‚¬ëŒë“¤ì´ ê²€ìƒ‰í•  ê°€ëŠ¥ì„±ì´ ë†’ì€ ë°ì´í„°**ë¥¼ ë„£ìœ¼ë©´ ì¶©ë¶„í•˜ë‹¤.

---

- ì‹¤ë¬´ì—ì„œ ì¶”ì²œì–´ë¥¼ êµ¬ì„±í•˜ëŠ” ë°©ë²•
    
    
    | **ë°©ì‹** | **ì„¤ëª…** |
    | --- | --- |
    | ğŸ”¹ **ì„œë¹„ìŠ¤ ë°ì´í„° ê¸°ë°˜** | ì˜ˆ: ì‡¼í•‘ëª° â†’ ìƒí’ˆëª…, ê²Œì‹œíŒ â†’ ê¸€ ì œëª© |
    | ğŸ”¹ **ê²€ìƒ‰ ë¡œê·¸ ê¸°ë°˜** | ì‚¬ëŒë“¤ì´ ì‹¤ì œë¡œ ê²€ìƒ‰í•œ í‚¤ì›Œë“œ ì¤‘ ìì£¼ ì“°ì¸ ê²ƒë§Œ ì €ì¥ |
    | ğŸ”¹ **ìë™ ì‚¬ì „ ìƒì„±** | íŠ¹ì • DB í…Œì´ë¸”ì—ì„œ ì •ê¸°ì ìœ¼ë¡œ ê°€ì ¸ì™€ì„œ ESì— ë„£ê¸° |
    | ğŸ”¹ **ì™¸ë¶€ ì‚¬ì „ í™œìš© (ì„ íƒ)** | í•œê¸€ ì‚¬ì „, ìœ„í‚¤ë°±ê³¼ ì œëª© ë“± ê¸ì–´ì™€ì„œ ì´ˆê¸° ë°ì´í„° êµ¬ì„± |

---

ì˜ˆë¥¼ ë“¤ì–´ í•„ìê°€ ë§Œë“  ì›¹ì•±ì—ì„œ ê²€ìƒ‰ì´ í•„ìš”í•œ ëŒ€ìƒì´

- ì»¤ë®¤ë‹ˆí‹° â†’ ê²Œì‹œê¸€ ì œëª©, í‚¤ì›Œë“œ

ì´ë¼ë©´ ì´ **â€œì œëª©â€** ë“¤ì„ ë¯¸ë¦¬ ì¸ë±ì‹±í•´ì„œ ìë™ì™„ì„± ëŒ€ìƒìœ¼ë¡œ ì“°ë©´ ëœë‹¤.

---

ì˜ˆì‹œë¡œ ì´ëŸ° ê²ƒë„ ê°€ëŠ¥í•˜ë‹¤.

> PostgreSQL DBì— ìˆëŠ” title ì»¬ëŸ¼ì„ ê¸°ì¤€ìœ¼ë¡œ ë§¤ì¼ 1íšŒ ìë™ìœ¼ë¡œ ESì— ì¶”ì²œì–´ ì—…ë°ì´íŠ¸
> 
> 
> ```sql
> SELECT DISTINCT title FROM posts WHERE LENGTH(title) > 1 LIMIT 10000;
> ```
> 

â†’ ì´ ê²°ê³¼ë¥¼ ìŠ¤í¬ë¦½íŠ¸ë¡œ ESì— ë„£ê³  ìë™ì™„ì„± ì¶”ì²œìš©ìœ¼ë¡œ ì‚¬ìš©í•˜ë©´ ëœë‹¤.

ì•„ë‹ˆë©´, ê²€ìƒ‰ ë¡œê·¸ë¥¼ ë¶„ì„í•´ì„œ ì‚¬ìš©ìë“¤ì´ ìì£¼ ì“°ëŠ” ë‹¨ì–´ë“¤ë¡œ ìœ ì§€í•˜ì—¬ë„ ì¶©ë¶„í•˜ë‹¤.


---
> ë‹¤ìŒ í¬ìŠ¤íŒ…ì—ì„œëŠ” ì˜¤íƒ€ êµì • ê¸°ëŠ¥ì— ëŒ€í•´ì„œ ì„¤ëª…í•˜ê² ë‹¤.